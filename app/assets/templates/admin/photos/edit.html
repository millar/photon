<loading-icon></loading-icon>

<div class="container reveal-animation" ng-if="loaded">
  <div class="row separated">
    <div class="col-md-3 img-preview text-right">
      <photo-square class="text-right" photo="photo" href="'/admin/photos/' + photo.id" size="75"></photo-square>
    </div>
    <div class="col-md-6">
      <h2 style="margin-top: 0;" ng-class="{'text-muted': !photo.title}">{{photo.title || photo.original_file_name}}</h2>
      <ul class="list-inline">
        <li>Uploaded <span isodate="photo.created_at"></span></li>
        <li>
          by
          <span ng-if="photo.user.id == current_user.id">you</span>
          <span ng-if="photo.user.id != current_user.id">{{photo.user.username}}</span>
        </li>
      </ul>
    </div>
  </div>


  <form class="form-horizontal" ng-submit="submit()">
    <div class="form-group">
      <label class="control-label col-sm-3" for="title">Title</label>
      <div class="col-sm-6">
        <input type="text" ng-model="photo.title" class="form-control">
      </div>
    </div>

    <div class="form-group">
      <label class="control-label col-sm-3" for="title">Description</label>
      <div class="col-sm-6">
        <textarea ng-model="photo.description" class="form-control"></textarea>
      </div>
    </div>

    <div class="form-group">
      <div class="col-sm-6 col-sm-offset-3">
        <button type="submit" class="btn btn-primary">Update Photo</button>
      </div>
    </div>
  </form>

  <div class="row separated">
    <div class="col-md-6 col-md-offset-3">
      <h4>
        Featured in
      </h4>
      <div ng-if="photo.albums.length">
        <table class="table">
          <tr>
            <th colspan="2">Album Title</th>
          </tr>
          <tr ng-repeat="album in photo.albums" data-pending="album-{{album.id}}">
            <td><a ng-href="/admin/albums/{{album.id}}"><strong>{{album.title}}</strong></a></td>
            <td class="text-right"><a ng-click="removeFromAlbum(album.id)"><span class="octicon octicon-x text-muted"></span></a></td>
          </tr>
        </table>
      </div>
      <p ng-if="!photo.albums.length" class="text-muted">No albums</p>
      <button type="button" class="btn btn-success btn-sm" data-toggle="modal" data-target="#addAlbumModal" ng-click="loadAlbums()">Add to album</button>
    </div>
  </div>

</div>

<div class="modal fade" id="addAlbumModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
        <h4 class="modal-title" id="myModalLabel">Add to album</h4>
      </div>
      <loading-icon loaded="albumsLoaded">
        <table class="table table-modal" ng-if="albumsLoaded && (albums | notInArray:photo.albums).length">
          <tr>
            <th>Title</th>
          </tr>
          <tr ng-repeat="album in albums | notInArray:photo.albums" data-pending="album-{{album.id}}">
            <td><a ng-click="addToAlbum(album.id)">{{album.title}}</a></td>
          </tr>
        </table>
        <div class="modal-body" ng-if="!(albums | notInArray:photo.albums).length">
          No<span ng-if="albums.length"> more</span> albums available.
        </div>
      </loading-icon>
      <div class="modal-footer" style="text-align:center;">
        <small class="text-muted">Click on an album to add this photograph</small>
      </div>
    </div>
  </div>
</div>
